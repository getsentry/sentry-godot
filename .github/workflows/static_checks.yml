name: ☑️ Static checks

on:
  workflow_call:

jobs:
  static-checks:
    runs-on: ubuntu-latest
    env:
      GODOT_SUFFIX: linux.x86_64
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          submodules: false # don't initialize submodules automatically

      - name: Prepare testing
        uses: ./.github/actions/prepare-testing

      - name: Check built-in documentation
        shell: bash
        timeout-minutes: 5
        run: |
          pwsh ./scripts/update-doc-classes.ps1
          changed=$(git diff --porcelain doc_classes/)
          if [[ -n $changed ]]; then
            echo "Documentation needs to be updated:"
            echo $changed
            echo "Tip: Run ./scripts/update-doc-classes.ps1 to update XML files in doc_classes directory."
            exit 1
          else
            echo "Documentation is up-to-date."
          fi
